#! /bin/usr/env bash

if [ -f "$HOME/.profile_local" ]; then
    source "$HOME/.profile_local"
fi

export EDITOR=nvim

# ------------------------------------------------------------------------------
# XDG
# ------------------------------------------------------------------------------

if [ -n "$DOTFILES" ]; then
    if [ -d "$HOME/projects/dotfiles" ]; then
        DOTFILES=$HOME/projects/dotfiles
    fi
    export XDG_CONFIG_HOME="$DOTFILES/config"
else
    echo "DOTFILES is not defined"
fi

if [ -z "$XDG_BASE" ]; then
    echo "Warning: XDG_BASE is not defined, using $HOME"
    XDG_BASE=$HOME
fi

export XDG_CACHE_HOME="$XDG_BASE/.cache"
export XDG_DATA_HOME="$XDG_BASE/.data"
export XDG_RUNTIME_DIR="$XDG_BASE/.runtime"

[ -d "$XDG_RUNTIME_DIR" ] || mkdir "$XDG_RUNTIME_DIR"
[ -d "$XDG_CACHE_HOME"  ] || mkdir "$XDG_CACHE_HOME"
[ -d "$XDG_DATA_HOME"   ] || mkdir "$XDG_DATA_HOME"

if [ -d "$XDG_CACHE_HOME" ]; then
    export PYLINTHOME="$XDG_CACHE_HOME/pylint"
    export PYTHON_EGG_CACHE="$XDG_CACHE_HOME/python-eggs"
fi

if [ -d "$XDG_RUNTIME_DIR" ]; then
    export TMUX_TMPDIR="$XDG_RUNTIME_DIR/tmux"
fi

if [ -d "$XDG_CONFIG_HOME" ]; then
    export INPUTRC="$XDG_CONFIG_HOME/readline/inputrc"
    export NPM_CONFIG_USERCONFIG=$XDG_CONFIG_HOME/npm/npmrc
    export RIPGREP_CONFIG_PATH=$XDG_CONFIG_HOME/ripgreprc
fi

if [ -d "$XDG_DATA_HOME" ]; then
    export CARGO_HOME="$XDG_DATA_HOME/cargo"
    export RLWRAP_HOME="$XDG_DATA_HOME/rlwrap"
fi

# ------------------------------------------------------------------------------
# Brew
# ------------------------------------------------------------------------------

# Makes brew edit work properly with nvim
# export HOMEBREW_NO_ENV_FILTERING=1
export HOMEBREW_CACHE="$XDG_CACHE_HOME"

export HOMEBREW_DEVELOPER=1
export HOMEBREW_CURL_PATH=/devtools/conda/bin/curl
export HOMEBREW_GIT_PATH=/devtools/conda/bin/git

# ------------------------------------------------------------------------------
# Misc
# ------------------------------------------------------------------------------

if [ -n "$BREW_PREFIX" ]; then
  COREUTILS_PATH="$BREW_PREFIX/opt/coreutils/libexec"
  [ -d "$COREUTILS_PATH/gnubin" ] && PATH="$COREUTILS_PATH/gnubin:$PATH"
  [ -d "$COREUTILS_PATH/gnuman" ] && MANPATH="$COREUTILS_PATH/gnuman:$MANPATH"
fi

for i in \
    "$HOME" \
    "$DOTFILES" \
    "$HOME/.luarocks" \
    "$HOME/.local" \
    "$XDG_DATA_HOME/npm" \
    "$XDG_DATA_HOME/cargo"
do
    [ -d "$i/bin"       ] && PATH="$i/bin:$PATH"
    [ -d "$i/man"       ] && MANPATH="$i/man:$MANPATH"
    [ -d "$i/share/man" ] && MANPATH="$i/share/man:$MANPATH"
    [ -d "$i/info"      ] && INFOPATH="$i/info:$INFOPATH"
done
